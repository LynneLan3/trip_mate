# 头像上传功能配置说明

## 功能概述

新增功能包括：
1. ✅ 用户可以上传自己的头像
2. ✅ 不上传头像时使用默认头像
3. ✅ 性别默认选择女性
4. ✅ 联系方式为必填项

## Supabase Storage 配置步骤

### 方法一：通过 Supabase Dashboard 手动创建

1. 登录 Supabase Dashboard
2. 进入你的项目
3. 点击左侧菜单的 **Storage**
4. 点击 **New bucket** 创建新存储桶
5. 填写以下信息：
   - Name: `avatars`
   - Public bucket: **勾选此项**（允许公开访问）
6. 点击 **Create bucket**

### 方法二：执行 SQL 脚本

1. 登录 Supabase Dashboard
2. 进入你的项目
3. 点击左侧菜单的 **SQL Editor**
4. 点击 **New query**
5. 复制 `创建头像存储桶.sql` 文件中的内容并执行

## 代码修改说明

### 1. ProfilePage.tsx 修改
- 添加了头像上传功能
- 点击头像可以上传新图片
- 支持图片预览
- 限制图片大小为 2MB
- 性别默认选择为"女"
- 联系方式为必填项，不填写无法保存

### 2. client.ts 修改
- `createUserProfile` 函数现在会设置默认头像和默认性别（女性）

## 使用说明

### 用户端使用
1. 新用户注册后会自动跳转到编辑信息页面
2. 页面会自动进入编辑模式
3. 头像会显示默认头像
4. 性别默认选择为"女"
5. 用户可以：
   - 点击头像上传自己的照片
   - 填写昵称（必填）
   - 选择性别
   - 填写联系方式（必填）
   - 填写所在地区
   - 填写个人简介
6. 只有填写了昵称和联系方式后才能保存

### 头像上传限制
- 只能上传图片文件（jpg, png, gif, webp 等）
- 文件大小不能超过 2MB
- 上传时会显示加载动画

## 默认头像

使用的是 DiceBear 的免费头像 API：
`https://api.dicebear.com/7.x/avataaars/svg?seed=default`

如果需要更换默认头像，可以修改 `ProfilePage.tsx` 中的 `DEFAULT_AVATAR_URL` 常量。

## 注意事项

1. **必须先配置 Supabase Storage**：在使用头像上传功能前，必须先创建 avatars 存储桶
2. **权限设置**：确保存储桶策略正确设置，允许认证用户上传和更新自己的头像
3. **公开访问**：avatars 存储桶必须设置为 public，否则头像无法显示
4. **文件命名**：上传的文件会以 `{userId}-{timestamp}.{ext}` 格式命名，避免文件名冲突
5. **数据迁移**：现有用户的性别字段可能为空，编辑时会自动设置为"女"

## 测试清单

- [ ] 新用户注册后能正常跳转到编辑页面
- [ ] 默认显示默认头像
- [ ] 性别默认选择为"女"
- [ ] 点击头像能弹出文件选择对话框
- [ ] 能成功上传图片并显示
- [ ] 不填写联系方式无法保存
- [ ] 不填写昵称无法保存
- [ ] 保存后头像正常显示
- [ ] 刷新页面后头像仍然显示

## 后续优化建议

1. 添加图片裁剪功能
2. 支持拖拽上传
3. 添加头像删除功能（恢复为默认头像）
4. 优化上传进度显示
5. 添加图片压缩功能（客户端压缩后再上传）
